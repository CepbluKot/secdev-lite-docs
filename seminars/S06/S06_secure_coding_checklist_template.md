# S06 - Secure Coding Checklist (template)

> Цель: зафиксировать **что именно** вы починили на S06, **где это подтверждено тестами/артефактами**, и **как это мапится на DV1-DV5**.

## Как пользоваться

1. Отметьте **минимум 2 карточки** из `S06_patch_cards.md`, которые вы реализуете.
2. В каждом разделе ниже проставьте чекбоксы, укажите **коммиты** и **пути к пруфам** в `EVIDENCE/S06/`.
3. В конце заполните сводку для переноса в `GRADING/DV.md`.

---

## Паспорт выполнения (заполнить)

* Команда/репозиторий: **ТУТ НУЖНА ТВОЯ ВСТАВКА**
* Коммит(ы) с фиксом: **ТУТ НУЖНА ТВОЯ ВСТАВКА** (короткие SHA)
* One-liner (DV1): **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  Отчёт тестов: `EVIDENCE/S06/test-report.xml` (или `.txt/.html`)
* Кратко «что было → что сделали»: **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## Выбранные карточки (отметьте не менее двух)

* [ ] **S06-01 - SQLi (login)**
* [ ] **S06-02 - SQLi (search LIKE)**
* [ ] **S06-03 - XSS (экранирование вывода)**
* [ ] **S06-04 - Валидация ввода (строгость/длины/паттерны)**
* [ ] **S06-05 - Ошибки и логи без утечек**
* [ ] **S06-06 - Security-заголовки (минимум)**
* [ ] **S06-07 - Гигиена секретов и конфигов**
* [ ] **S06-08 - Anti-bruteforce (лайт)**

---

## 1) SQL Injection - login (`POST /login`)

* [ ] Параметризация запроса (никаких f-строк)
* [ ] Тест(ы) подтверждают блокировку `admin'--`
* [ ] (Опц.) Ограничения на логин/пароль в модели
  **Пруфы:** `EVIDENCE/S06/test-report.xml`, `EVIDENCE/S06/patches/login.diff` (опц.)
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 2) SQL Injection - search (`GET /search?q=...`)

* [ ] Параметризация `LIKE ?` + шаблон `%q%`
* [ ] Тест(ы) подтверждают, что инъекция не возвращает все записи
* [ ] (Опц.) Лимит длины `q`
  **Пруфы:** `EVIDENCE/S06/test-report.xml`, скрин «до/после» (опц.)
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 3) XSS - экранирование вывода (шаблоны Jinja2)

* [ ] Убрано `|safe` или внедрено безопасное кодирование
* [ ] Тест(ы) подтверждают отсутствие `<script>` в ответе
  **Пруфы:** `EVIDENCE/S06/test-report.xml`, `EVIDENCE/S06/screenshots/xss_before_after.png` (опц.)
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 4) Валидация ввода (строгость)

* [ ] Модель `LoginRequest` ужата по длинам/паттернам
* [ ] `q` в `/search` ограничен (min/max)
* [ ] Тест(ы) на 400/422 и на корректные значения
  **Пруфы:** `EVIDENCE/S06/test-report.xml`
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 5) Ошибки и логирование без утечек

* [ ] Обработчик исключений возвращает нейтральные сообщения (без стеков/секретов)
* [ ] Логи без чувствительных данных (маскирование при необходимости)
* [ ] Тест(ы) подтверждают «безопасный» ответ/лог
  **Пруфы:** `EVIDENCE/S06/logs/app.log` (если есть), `EVIDENCE/S06/test-report.xml`
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 6) Security-заголовки (минимальный набор)

* [ ] `X-Content-Type-Options: nosniff`
* [ ] `X-Frame-Options: DENY`
* [ ] `Referrer-Policy: no-referrer`
* [ ] `Content-Security-Policy: default-src 'self'`
* [ ] Тест(ы) проверяют присутствие заголовков
  **Пруфы:** `EVIDENCE/S06/test-report.xml`
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 7) Гигиена секретов и конфигов

* [ ] Используются переменные окружения (`os.getenv`) вместо хардкода
* [ ] В репозитории нет секретов; есть `.env.example`
* [ ] README дополнен разделом «Конфиги/переменные окружения»
* [ ] (Опц.) Простая проверка чтения env в рантайме
  **Пруфы:** `EVIDENCE/S06/test-report.xml`, `EVIDENCE/S06/screenshots/git_status_no_secrets.png`
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## 8) Anti-bruteforce (лайт)

* [ ] Ограничение попыток логина (например, 5/мин на IP+логин)
* [ ] Тест(ы) подтверждают 429 при превышении лимита
  **Пруфы:** `EVIDENCE/S06/test-report.xml`
  **Коммиты:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**
  **Комментарий:** **ТУТ НУЖНА ТВОЯ ВСТАВКА**

---

## Артефакты S06 (минимум)

* [ ] `EVIDENCE/S06/test-report.xml` (или `.txt/.html`)
* [ ] `EVIDENCE/S06/logs/*` (если есть)
* [ ] `EVIDENCE/S06/screenshots/*` (если есть)
* [ ] `EVIDENCE/S06/patches/*.diff` (опц.)

---

## Сводка для переноса в `GRADING/DV.md`

* **DV1 (Воспроизводимость):** one-liner → `ТУТ НУЖНА ТВОЯ ВСТАВКА`, отчёт → `EVIDENCE/S06/test-report.xml`
* **DV2 (Гигиена секретов):** `.env.example`, отсутствие секретов в репо, чтение через env
* **DV3 (Минимальная безопасность кода):** карточки: **ТУТ НУЖНА ТВОЯ ВСТАВКА** (список), кратко «что было → что сделали»
* **DV4 (Артефакты/логи):** перечислите пути: **ТУТ НУЖНА ТВОЯ ВСТАВКА**
* **DV5 (Инструкции):** ссылка на README-раздел «Локальный запуск» + отсылка к one-liner

---

## Definition of Done - перед сдачей

* [ ] Выбраны **≥2** карточки, все тесты по ним **зелёные**
* [ ] Коммиты/диффы понятны; ссылки на артефакты рабочие
* [ ] One-liner без интерактива; отчёт в `EVIDENCE/S06/`
* [ ] Секретов нет; `.env.example` присутствует
