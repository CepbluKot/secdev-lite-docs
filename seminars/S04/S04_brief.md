# S04 - DFD + STRIDE + приоритизация (brief)

**Цель семинара (80 мин):**
Собрать **минимальную DFD** (3-5 узлов с **границами доверия**), пройти **STRIDE per element**, быстро оценить риски по **L×I (1-5)** и выделить **топ-5** для последующих ADR на S05.

---

## Что подготовить заранее (DoR)

* Доступ к результатам S03 (ваш реестр NFR: ID, категории, G-W-T).
* Пустые шаблоны из этой папки:

  * `S04_dfd_template.md`
  * `S04_stride_matrix_template.md`
  * `S04_risk_scoring_template.md`
* Определённые команды (3-4 чел.).

---

## Ход работы (тайминг)

0. **Ввод (5-10 мин)** - напоминание:
DFD = узлы/хранилища/потоки + **trust boundaries**. STRIDE = **S**poofing, **T**ampering, **R**epudiation, **I**nfo disclosure, **D**oS, **E**levation.

1. **Мини-DFD (15-20 мин)**

* 3-5 узлов максимум, явно отметить границы доверия.
* Подписать ключевые **потоки данных** (token, PII, файлы, платежи).
* Используйте mermaid (можно прямо в `S04_dfd_template.md`):

  ```mermaid
  flowchart LR
    subgraph Internet[Интернет / Внешние клиенты]
      C[Клиент/Браузер]
    end

    subgraph Service[Сервис - приложение]
      A[API Gateway/Controller]
      S[Сервис/Бизнес-логика]
      D[База данных]
    end

    subgraph External[Внешние провайдеры]
      X[External API/Payment]
    end

    C -- JWT/HTTPS --> A
    A -->|DTO/Requests| S
    S -->|SQL/ORM| D
    S -->|HTTP/gRPC| X

    classDef boundary fill:#f6f6f6,stroke:#999,stroke-width:1px;
    class Internet,Service,External boundary;
  ```

2. **STRIDE per element (25-30 мин)**
Для **каждого элемента/потока** пройти 6 букв STRIDE, фиксируя краткие угрозы и **ссылки на связанные NFR-ID** из S03. Работайте в `S04_stride_matrix_template.md`. Здесь только фиксация угроз, NFR-ID и набросок mitigation.

3. **Приоритизация L×I (10-15 мин)**
Перейдите в `S04_risk_scoring.md`, объедините дубли из STRIDE-матрицы (consolidation), выставьте **L** и **I** по шкале 1-5, посчитайте `Score = L×I`, отсортируйте и выберите **топ-5**.

4. **Согласование (5 мин)**
Проверка на дубли/конфликты, финализация топ-5 под ADR (S05).

---

## Правила для DFD (минимум)

* **3-5 узлов**: Клиент, API/Controller, Service, DB, (опционально) External API/Queue.
* Чётко показать **trust boundaries**: Интернет ↔ Сервис; Сервис ↔ Внешние; Сервис ↔ БД.
* Подписывать **типы данных** на рёбрах (token/PII/file/payment).

---

## Правила для STRIDE per element

* Проходим **per element**, а не «вообще».
* На каждую букву STRIDE - 0-2 внятные угрозы (если релевантно).
* У каждой угрозы - **NFR-ID** из S03 (или пометка «нужен новый NFR»).
* Короткая формулировка будущего **mitigation** (под ADR в S05).

---

## Шкала приоритизации L×I (1-5)

**L (Likelihood, 1-5):**
1 - Маловероятно (сложно эксплуатировать, редкая поверхность, хорошая детекция)
2 - Низкая
3 - Средняя
4 - Высокая
5 - Очень высокая (публичная поверхность, типовая уязвимость, слабая детекция)

**I (Impact, 1-5):**
1 - Низкий (локальный эффект, без PII/денег/доступности)
2 - Умеренный
3 - Значимый (PII/деньги отдельного клиента/команды)
4 - Высокий (существенный ущерб, длительные простои)
5 - Критичный (массовая утечка, компрометация прав, простой сервиса)

**Score = L×I** → сортировка → **топ-5** рисков.

---

## Что получаем по итогам пары

* **Мини-DFD** (mermaid) с обозначенными границами доверия и потоками.
* **Матрица STRIDE per element** с краткими угрозами и ссылками на **NFR-ID**.
* **Список рисков L×I (1-5)** и выделенный **топ-5** для последующих ADR (S05).
* Команда понимает «зачем» и **что именно** пойдёт в `TM.md` и ADR.

---

## После семинара (минимум)

* Добавьте в ваш `TM.md`:

  * мини-DFD (код mermaid),
  * сводную таблицу STRIDE per element,
  * список рисков L×I и **топ-5** (с кратким обоснованием L и I).
* Подготовьте черновики ADR для топ-5 к S05.

---

## Частые ошибки и как их избежать

* **Слишком детальная DFD.** Держитесь уровня сервиса; 3-5 узлов достаточно.
* **STRIDE «в общем».** Заполняйте **для каждого элемента/потока**.
* **Нет связи с NFR.** У каждой угрозы должен быть **минимум один NFR-ID** из S03 (или отметка «нужен новый NFR»).
* **Приоритизация «на глаз».** Используйте шкалу **1-5** для L и I, фиксируйте краткое обоснование.
* **Уходим в фиксы.** Исправления и решения - это **S05 (ADR)**; тут - приоритет и контекст.
