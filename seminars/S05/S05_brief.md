# S05 - ADR для топ-рисков (brief)

**Цель семинара (80 мин):**
Преобразовать **топ-риски из S04** в **конкретные архитектурные решения**: выбрать **2-3 риска** «в работу», сравнить **2-3 альтернативы** по каждому, принять решение и оформить **ADR** со строгим **DoD/Acceptance**.

---

## Что подготовить заранее (DoR)

* Результаты **S03** (реестр NFR с ID) и **S04** (DFD mermaid, STRIDE-матрица, `risk_scoring.md` с Top-5 и L×I 1-5).
* Из этой папки docs возьмите шаблоны:

  * `S05_adr_template.md` - шаблон ADR,
  * `S05_option_matrix_template.md` - матрица сравнения вариантов,
  * `S05_pattern_bank.md` - банк типовых решений (подсказки по параметрам).
* Сформированные команды **3-4 человека**.

---

## Ход работы (тайминг)

**0-10 мин - Ввод/фокус.**
Освежите **Top-5** из S04 и выберите **2-3 риска**, которые берёте «в работу сейчас» (остальные - в бэклог).

**10-25 мин - Генерация альтернатив.**
На каждый выбранный риск перечислите **2-3 реалистичные альтернативы** (с опорой на `S05_pattern_bank.md`). Коротко сформулируйте, **что именно** меняем (конфиг/политика/порог/флаг) и где (gateway/service/DB).

**25-45 мин - Сравнение вариантов (option matrix).**
Заполните `S05_option_matrix_<risk-id>.md`:
оцените **Security impact** и **Blast radius reduction** (↑, 1-5), а также **Complexity**, **Time-to-mitigate**, **Dependencies** (↓, 1-5). Посчитайте **Benefit/Cost/Net** и примените тай-брейкеры при равенстве.

**45-70 мин - Оформление ADR.**
На каждый принятый риск создайте файл `S05_ADR_<slug>.md` по `S05_adr_template.md`:
`Context (Risk-ID, NFR-ID, DFD, L×I) → Decision (параметры/политики) → Alternatives → Consequences → DoD/Acceptance (G-W-T, что проверим) → Trace`.

**70-80 мин - Синхронизация.**
Коротко презентуйте решения соседней команде, фиксаните статус ADR = `Proposed`, подпишите owners.

---

## Правила оформления (важно)

* **DoD/Acceptance** - только **проверяемые** формулировки (Given-When-Then + что именно проверит тест/лог/скан/метрика).
* В **Decision** всегда указывайте **границы действия** (какие endpoints/роли/тенанты) и **уровень** (gateway/service/DB/policy).
* В **Trace** свяжите ADR с `Risk-ID` (S04), `NFR-ID` (S03), DFD-элементом и задачами.

---

## Что получаем по итогам пары

* **2-3 ADR (Status: Proposed)** - на выбранные риски из Top-5 (S04).
* **Матрицы вариантов** по каждому обработанному риску (аргументация выбора).
* **Бэклог**: оставшиеся риски Top-5 с пометкой, когда вернуться.

---

## После семинара (минимум)

* Короткое ревью → перевести ADR в `Approved`.
* Добавить ссылки на ADR в `TM.md` (раздел Decisions), привязать к **Risk-ID** и **NFR-ID**.
* Создать технические задачи под реализацию (конфиги/политики/параметры) - они пойдут в следующие «лайт»-семинары.

---

## Частые ошибки и как их избежать

* **«Вода» в DoD.** Заменяйте «улучшили безопасность» на конкретные проверки: код ответа/заголовок/паттерн лога/метрика/порог.
* **Слишком общая альтернатива.** Всегда фиксируйте **конкретные параметры** и **область действия**.
* **Нет связки с S03/S04.** В `Context/Trace` обязательно указывайте **Risk-ID**, **NFR-ID**, DFD-элемент, ссылки на STRIDE/Scoring.
* **Пытаемся всё сразу.** На паре оформляем **2-3 ADR**, остальное - в бэклог с приоритетом.

---

## Полезные материалы в этой папке

* `S05_adr_template.md` - шаблон ADR.
* `S05_option_matrix_template.md` - как взвесить альтернативы и зафиксировать выбор.
* `S05_pattern_bank.md` - готовые паттерны (AuthN/RBAC/Limits/Errors/Timeouts/PII/Logs/Audit/Container/DB/Flags/Async и др.).
